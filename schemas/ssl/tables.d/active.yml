name: active
description: |
 Active cert_active

primary_key:
 - demand_id
 - machine_name

templates:
 - system.reference_service_entity

columns:
 - name: demand_id
   type: uuid
   description: X
 - name: machine_name
   type: dns.t_domain
   description: Machine
 - name: currently
   type: uuid
   description: Currently active certificate
   null: true
 - name: subsequently
   type: uuid
   description: Next certificate that will be active
   null: true

unique:
 - name: machine
   columns:
    - service
    - service_entity_name
    - machine_name

foreign_keys:
 - name: machine_with_service
   ref_table: system.service_entity_machine
   columns:
    - service
    - service_entity_name
    - machine_name
 - name: currently_active
   ref_table: ssl.cert
   columns: 
    - currently
    - machine_name
   ref_columns:
    - id
    - machine_name


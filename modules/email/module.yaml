name: email
description: E-Mail System
dependencies: [ domains ]

column_templates:
 -
  template: name
  name: name
  type: dns.domain_name
  description: Name like sub.example.org. This defines to which name the resource record pertains.
 -
  template: type
  name: type
  type: dns.type
  description: Type (?) like MX, A, AAAA, ...

table_templates:
 -
  template: address

  foreign_keys:
   -
    name: test1
    columns:
     - domain
     - rr_type
    ref_table: dns.name_host
    ref_columns:
     - name
     - type

  columns:
   -
    tag: column
    name: local_part
    type: email.local_part
    description: Local part of the address
   -
    tag: column
    name: domain
    type: dns.domain_name
    description: Domain part of the address
   -
    tag: column
    name: rr_type
    type: dns.type
    description: strange thing
    check: VALUE == 'MX'
    default: "'MX'"
   -
    tag: column_tpl
    template: user.owner

domains:
 -
  name: local_part
  description: Local part of an e-mail address, the thing in front of the @
  type: varchar(64)
  
  checks:
   -
    name: valid_characters
    description: a
    check: "VALUE ~ '[A-Za-z0-9.]'"
    #check: "regexp_matches(VALUE, '[A-Za-z0-9.!#$%&'*+-/=?^_`{|}~]+')"
   -
    name: no_starting_dot
    description: b
    check: left(VALUE, 1) <> '.'
   -
    name: no_ending_dot
    description: c
    check: right(VALUE, 1) <> '.'

